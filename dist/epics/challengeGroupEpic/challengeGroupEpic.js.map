{"version":3,"sources":["../../../src/epics/challengeGroupEpic/challengeGroupEpic.ts"],"names":["newChallengeGroupEpic","action$","state$","pipe","CREATE_CHALLENGE_GROUP","action","commonReducer","value","get","payload","contract","address","methods","createChallengeGroup","Object","values","send","from","response","status","gasUsed","error","err","console","log"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAGO,IAAMA,qBAAqB,GAAG,SAAxBA,qBAAwB,CACnCC,OADmC,EAEnCC,MAFmC;AAAA,SAInCD,OAAO,CAACE,IAAR,CACE,6BAAOC,8BAAP,CADF,EAEE,0BAAU,UAACC,MAAD,EAAoB;AAAA;;AAC5B,QAAMC,aAAa,GAAGJ,MAAM,CAACK,KAAP,CAAaC,GAAb,CAAiB,QAAjB,CAAtB;AACA,QAAMC,OAAO,GAAGJ,MAAM,CAACI,OAAvB;AAF4B,eAGA,CAC1BH,aAAa,CAACE,GAAd,CAAkB,UAAlB,CAD0B,EAE1BF,aAAa,CAACE,GAAd,CAAkB,aAAlB,CAF0B,CAHA;AAAA,QAGrBE,QAHqB;AAAA,QAGXC,OAHW;AAQ5B,WAAO,gBACL,qBAAAD,QAAQ,CAACE,OAAT,EACGC,oBADH,6CAEOC,MAAM,CAACC,MAAP,CAAcN,OAAd,CAFP,UAGIP,MAAM,CAACK,KAAP,CAAaC,GAAb,CAAiB,QAAjB,EAA2BA,GAA3B,CAA+B,UAA/B,EAA2C,CAA3C,CAHJ,IAKGQ,IALH,CAKQ;AAAEC,MAAAA,IAAI,EAAEN;AAAR,KALR,CADK,EAOLR,IAPK,CAQL,oBAAI,UAACe,QAAD,EAAmB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,aAAO,6BAAgB;AACrBA,QAAAA,QAAQ,EAAE;AACRC,UAAAA,MAAM,EAAED,QAAQ,CAACC,MADT;AAERC,UAAAA,OAAO,EAAEF,QAAQ,CAACE;AAFV,SADW;AAKrBC,QAAAA,KAAK,EAAE;AALc,OAAhB,CAAP;AAOD,KA7BD,CARK,CAAP;AAuCD,GA/CD,CAFF,EAkDE,2BAAW,UAACC,GAAD,EAAc;AACvB;AACA;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACA,WAAO,cACL,6BAAgB;AACdJ,MAAAA,QAAQ,EAAE,EADI;AAEdG,MAAAA,KAAK,EAAE;AAFO,KAAhB,CADK,CAAP;AAMD,GAXD,CAlDF,CAJmC;AAAA,CAA9B;;;eAoEQ,CAACrB,qBAAD,C;AAEf","sourcesContent":["import { Action } from '@Src/typing/globalTypes'\nimport { CREATE_CHALLENGE_GROUP, setCreateResult } from './action'\nimport { ofType, ActionsObservable, StateObservable } from 'redux-observable'\nimport { map, switchMap, catchError } from 'rxjs/operators'\nimport { from, of } from 'rxjs'\nimport { ChallengeGroupType } from '@Src/typing/globalTypes'\n\nexport const newChallengeGroupEpic = (\n  action$: ActionsObservable<Action>,\n  state$: StateObservable<any>\n) =>\n  action$.pipe(\n    ofType(CREATE_CHALLENGE_GROUP),\n    switchMap((action: Action) => {\n      const commonReducer = state$.value.get('common')\n      const payload = action.payload as ChallengeGroupType\n      const [contract, address] = [\n        commonReducer.get('contract'),\n        commonReducer.get('userAddress')\n      ]\n\n      return from(\n        contract.methods\n          .createChallengeGroup(\n            ...Object.values(payload),\n            state$.value.get('common').get('accounts')[1]\n          )\n          .send({ from: address })\n      ).pipe(\n        map((response: any) => {\n          // const challengeObject = {\n          //   groupId: payload.id,\n          //   targetDays: payload.minDays + 1,\n          //   totalDays: payload.maxDays,\n          //   startTime: Math.floor(Date.now() / 1000)\n          // }\n          // contract.methods\n          //   .createChallenge(...Object.values(challengeObject))\n          //   .send({\n          //     from: address,\n          //     value: 100000000\n          //   })\n          //   .on('error', function(error: any) {\n          //     console.log(99999)\n          //     console.log(error)\n          //   })\n          //   .then((res: any) => {\n          //     console.log(222222)\n          //     console.log(res)\n          //   })\n\n          return setCreateResult({\n            response: {\n              status: response.status,\n              gasUsed: response.gasUsed\n            },\n            error: false\n          })\n        })\n      )\n    }),\n    catchError((err: any) => {\n      // invalid address\n      // connection not open\n      console.log(11111)\n      console.log(err)\n      return of(\n        setCreateResult({\n          response: {},\n          error: true\n        })\n      )\n    })\n  )\n\nexport default [newChallengeGroupEpic]\n\n/** Create receipt\n   * \n   * blockHash: \"0x16c55efa6a132400c87f31d33ad5f79ada8d788be9bb7adf190d2f7e6a3c5dff\"\nblockNumber: 5\ncontractAddress: null\ncumulativeGasUsed: 126914\nevents:\nNewChallengeGroup:\naddress: \"0x21e4624c5A0B3fdA81D0833d412DDED2bb3A7a7C\"\nblockHash: \"0x16c55efa6a132400c87f31d33ad5f79ada8d788be9bb7adf190d2f7e6a3c5dff\"\nblockNumber: 5\nevent: \"NewChallengeGroup\"\nid: \"log_cef17bc2\"\nlogIndex: 0\nraw: {data: \"0x000000000000000000000000000000000000000000000000â€¦0000000000000000000000000000000000000000000000000\", topics: Array(2)}\nreturnValues: Result {0: \"0x1d489c3F8Ed5Ee71325A847888B2157c9ac29c05\", 1: \"\", proposer: \"0x1d489c3F8Ed5Ee71325A847888B2157c9ac29c05\", id: \"\"}\nsignature: \"0x71d49af7e2735dd98a820c3e35a19b83758b3b63a172a20d4bbf357956e52ca4\"\ntransactionHash: \"0x42a93f6041c751b6120fad49f2acbb6ad7f8164a35b2093d2fc8fdda7ef4fd34\"\ntransactionIndex: 0\ntype: \"mined\"\n__proto__: Object\n__proto__: Object\nfrom: \"0x1d489c3f8ed5ee71325a847888b2157c9ac29c05\"\ngasUsed: 126914\nlogsBloom: \"0x00000000000000010000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000400000400000000000000000002400000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000\"\nr: \"0xff810bdb1944951a73f14f4dd1790fdc0e5c10151a448716b953cbd0347d7986\"\ns: \"0x1b4e98617429a0b59d321ba55ffd81e444511e6112c1396be28ea47e746e7db5\"\nstatus: true\nto: \"0x21e4624c5a0b3fda81d0833d412dded2bb3a7a7c\"\ntransactionHash: \"0x42a93f6041c751b6120fad49f2acbb6ad7f8164a35b2093d2fc8fdda7ef4fd34\"\ntransactionIndex: 0\nv: \"0x1c\"\n   */\n"],"file":"challengeGroupEpic.js"}